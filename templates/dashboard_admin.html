<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Administrador</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Carga correcta del CSS externo -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style/styleGeneral.css') }}?v=1">
</head>

<body class="d-flex flex-column min-vh-100 bg-light">


<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4">
    <!-- Logo -->
    <img src="{{ url_for('static', filename='images/logoSfer_ProductManager_blanco.png') }}" alt="Logo" width="50" height="50" class="mb-1">
    <a class="navbar-brand me-3" href="{{ url_for('dashboard_admin') }}"> DASHBOARD ADMINISTRADOR </a>

    <!-- Botón hamburguesa -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Menú colapsable -->
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
            <!-- Productos al lado del dashboard -->
            <li class="nav-item">
                <a class="nav-link" href="{{ url_for('admin_productos') }}">Productos</a>
            </li>
        </ul>
        <ul class="navbar-nav ms-auto">
            <!-- Cerrar sesión alineado a la derecha -->
            <li class="nav-item">
                <a class="nav-link text-danger" href="{{ url_for('logout') }}">Cerrar sesión</a>
            </li>
        </ul>
    </div>
</nav>

<!-- Contenido principal -->
<div class="container mb-5">
    <h2 class="mb-4">Resumen del Administrador</h2>

    {% if productos_bajo_stock %}
    <div class="alert alert-warning d-flex align-items-center" role="alert">
      <i class="bi bi-exclamation-triangle-fill me-2"></i>
      <div>
        <strong>¡Atención!</strong> El Stock del siguiente producto es bajo!!:
        <ul class="mb-0 mt-2">
          {% for p in productos_bajo_stock %}
            <li><strong>    {{ p.nombre }}</strong> Stock actual: {{ p.cantidad_en_stock }}</li>
          {% endfor %}
        </ul>
      </div>
    </div>
    {% endif %}
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-body">
                    <h5 class="card-title">Total de Ventas</h5>
                    <p class="display-6">{{ total_ventas }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-body">
                    <h5 class="card-title">Beneficio Total</h5>
                    <p class="display-6">€ {{ '%.2f' % beneficio_total }}</p>
                </div>
            </div>
        </div>
    </div>

    <h4 class="mt-5">Gráfico de Ventas por Mes</h4>
    <canvas id="graficoVentas" height="100"></canvas>

    <h5 class="mt-4">Productos Más Vendidos</h5>
    <div class="list-group mb-5">
        {% for producto in productos_mas_vendidos %}
            <div class="list-group-item d-flex align-items-center">
                {% if producto.imagen %}
                    <img src="{{ url_for('static', filename='images/' + producto.imagen) }}" alt="{{ producto.nombre }}"
                    class="me-3 rounded" style="width: 50px; height: 50px; object-fit: cover; object-position: center;">

                {% else %}
                    <div class="bg-secondary text-white d-flex justify-content-center align-items-center rounded" style="width: 50px; height: 50px;">?</div>
                {% endif %}
                <div class="flex-grow-1">
                    {{ producto.nombre }}
                </div>
                <span class="badge bg-primary rounded-pill">{{ producto.ventas }}</span>
            </div>
        {% endfor %}
    </div>
</div>

<!-- Footer -->
<footer class="bg-dark text-white mt-auto pt-4">
    <div class="container">
        <div class="row justify-content-between align-items-center">
            <div class="col-md-6 mb-3 mb-md-0">
                <h5 class="text-uppercase fw-bold">SFER & PRODUCTMANAGER</h5>
                <p class="mb-0">Plataforma premium para la gestión inteligente de productos y proveedores.</p>
            </div>
            <div class="col-md-6 text-md-end">
                <p class="mb-1">
                    Contacto: <a href="mailto:sferproductmanager@gmail.com" class="text-white">sferproductmanager@gmail.com</a>
                </p>
                <a href="https://www.linkedin.com/in/sergio-fernández-lópez-8784bb270" target="_blank" class="text-white me-3 text-decoration-none">LinkedIn</a>
                <a href="https://www.instagram.com/sfer_productmanager?igsh=MWp5aWZ3bGhtcmx0Zw%3D%3D" class="text-white text-decoration-none">Instagram</a>
            </div>
        </div>
        <hr class="bg-light my-3">
        <div class="text-center text-secondary small pb-3">
            © {{ current_year if current_year else 2025 }} Sfer & ProductManager · Todos los derechos reservados
        </div>
    </div>
</footer>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById("graficoVentas").getContext("2d");
    const chart = new Chart(ctx, {
        type: "bar",
        data: {
            labels: {{ labels|tojson|default("[]", true) }},
            datasets: [{
                label: "Ingresos (€)",
                data: {{ valores|tojson|default("[]", true) }},
                backgroundColor: "rgba(54, 162, 235, 0.7)",
                borderColor: "rgba(54, 162, 235, 1)",
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
</script>

</body>
</html>
